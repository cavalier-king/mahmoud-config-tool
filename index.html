<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Mahmoud Config Tool</title>

<link rel="icon" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
body{
  background:#0b1220;
  color:#e5e7eb;
  font-family:'Vazirmatn',tahoma;
  padding:20px;
}
h1{margin:0}
small{color:#94a3b8}
textarea,input,button{font-family:inherit}

button{
  background:linear-gradient(135deg,#4f7cff,#b45cff);
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
  margin:6px 6px 0 0;
}

textarea{
  width:100%;
  height:220px;
  background:#020617;
  color:#e5e7eb;
  border:1px solid #334155;
  border-radius:8px;
  padding:10px;
  margin-top:10px;
}

.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:10px;
  padding:12px;
  margin-top:14px;
}

.title{color:#38bdf8;font-weight:600}

.config{
  font-size:12px;
  word-break:break-all;
  background:#020617;
  padding:6px;
  border-radius:6px;
  border:1px solid #1e293b;
  margin-top:6px;
}

.actions{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-top:6px;
}

.copy{background:#16a34a}
.qrbtn{background:#9333ea}
.apply{background:#f59e0b}

#dropZone{
  margin-top:10px;
  padding:20px;
  border:2px dashed #475569;
  border-radius:10px;
  text-align:center;
  color:#94a3b8;
  transition:.2s;
}
#dropZone.dragover{
  border-color:#22c55e;
  color:#22c55e;
  background:#020617;
}

.footer{
  margin-top:40px;
  text-align:center;
  font-size:13px;
  color:#94a3b8;
}
</style>
</head>

<body>

<!-- Header -->
<div style="display:flex;align-items:center;gap:14px;margin-bottom:14px">
  <img src="logo.png" style="width:56px;height:56px;border-radius:14px">
  <div>
    <h1>Mahmoud Config Tool</h1>
    <small>Multi-Protocol Subscription Parser Â· v1.0.0</small>
  </div>
</div>

<!-- Import -->
<button type="button" onclick="fileInput.click()">ğŸ“‚ Ø§ÛŒÙ…Ù¾ÙˆØ±Øª ÙØ§ÛŒÙ„ JSON Ø³Ø§Ø¨â€ŒØ§Ø³Ú©Ø±ÛŒÙ¾Ø´Ù†</button>
<input type="file" id="fileInput" accept=".json" style="display:none">

<div id="dropZone">ÛŒØ§ ÙØ§ÛŒÙ„ JSON Ø±Ø§ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯</div>
<div id="fileName" style="margin-top:6px;font-size:13px;color:#22c55e"></div>

<textarea id="jsonInput" placeholder="ÛŒØ§ JSON Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù¾ÛŒØ³Øª Ú©Ù†"></textarea>

<br>
<button onclick="parseJSON()">Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</button>
<button onclick="exportTXT()">Export TXT</button>
<button onclick="exportBase64()">Export Base64</button>

<div id="resultInfo" style="margin-top:10px;color:#22c55e"></div>
<div id="output"></div>

<div class="footer">
  Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ ØªÙˆØ³Ø· <b>Mahmoud</b><br>
  Free & Open Source
</div>

<script>
const fileInput = document.getElementById('fileInput');
const jsonInput = document.getElementById('jsonInput');
const output = document.getElementById('output');
const dropZone = document.getElementById('dropZone');
const fileName = document.getElementById('fileName');
const resultInfo = document.getElementById('resultInfo');

let configs=[];

// ---------- File handling ----------
fileInput.addEventListener('change', e=>{
  if(e.target.files[0]) handleFile(e.target.files[0]);
});

dropZone.addEventListener('dragover', e=>{
  e.preventDefault();
  dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', ()=>dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e=>{
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
});

function handleFile(file){
  if(!file.name.endsWith('.json')){
    alert('ÙÙ‚Ø· ÙØ§ÛŒÙ„ JSON Ù…Ø¬Ø§Ø² Ø§Ø³Øª');
    return;
  }
  const r=new FileReader();
  r.onload=ev=>{
    jsonInput.value=ev.target.result;
    fileName.innerText='âœ”ï¸ '+file.name+' Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯';
  };
  r.readAsText(file);
}

// ---------- Parser ----------
function parseJSON(){
  output.innerHTML='';
  resultInfo.innerText='';
  configs=[];
  let data;

  try{
    data=JSON.parse(jsonInput.value.trim());
  }catch{
    alert('JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
    return;
  }

  let outbounds=[];
  if(Array.isArray(data)){
    data.forEach(d=>d.outbounds && outbounds.push(...d.outbounds));
  }else if(data.outbounds){
    outbounds=data.outbounds;
  }else{
    alert('JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
    return;
  }

  outbounds.forEach(ob=>{
    let cfg=null;
    if(ob.protocol==='vless') cfg=buildVLESS(ob);
    if(ob.protocol==='vmess') cfg=buildVMESS(ob);
    if(ob.protocol==='trojan') cfg=buildTROJAN(ob);
    if(!cfg) return;

    const id=configs.length;
    configs.push(cfg);

    output.innerHTML+=`
      <div class="card">
        <div class="title">${cfg.protocol.toUpperCase()}</div>

        <input type="text" id="remark-${id}" value="${cfg.remark}">
        <button class="apply" onclick="applyRemark(${id})">Ø§Ø¹Ù…Ø§Ù„ Remark</button>

        <div class="config" id="link-${id}">${cfg.link}</div>

        <div class="actions">
          <button class="copy" onclick="copyLink(${id})">Ú©Ù¾ÛŒ</button>
          <button class="qrbtn" onclick="makeQR(${id})">QR</button>
        </div>

        <div id="qr-${id}"></div>
      </div>`;
  });

  resultInfo.innerText = 'ğŸ¯ '+configs.length+' Ú©Ø§Ù†ÙÛŒÚ¯ Ù¾ÛŒØ¯Ø§ Ø´Ø¯';
}

// ---------- Builders ----------
function buildVLESS(ob){
  const v=ob.settings.vnext[0];
  const u=v.users[0];
  const ws=ob.streamSettings.wsSettings||{};
  let q=['encryption=none','type=ws'];
  if(ws.path) q.push('path='+encodeURIComponent(ws.path));
  if(ws.host) q.push('host='+ws.host);
  const base=`vless://${u.id}@${v.address}:${v.port}?${q.join('&')}`;
  return {protocol:'vless',base,remark:'VLESS',link:base+'#VLESS'};
}

function buildVMESS(ob){
  const v=ob.settings.vnext[0];
  const ws=ob.streamSettings.wsSettings||{};
  const json={
    v:'2',ps:'VMESS',add:v.address,port:v.port,
    id:v.users[0].id,aid:'0',net:'ws',
    type:'none',host:ws.host||'',path:ws.path||'',
    tls:ob.streamSettings.security==='tls'?'tls':''
  };
  return {protocol:'vmess',remark:'VMESS',link:'vmess://'+btoa(JSON.stringify(json))};
}

function buildTROJAN(ob){
  const s=ob.settings.servers[0];
  const base=`trojan://${s.password}@${s.address}:${s.port}`;
  return {protocol:'trojan',base,remark:'TROJAN',link:base+'#TROJAN'};
}

// ---------- Actions ----------
function applyRemark(i){
  const r=document.getElementById('remark-'+i).value;
  configs[i].remark=r;
  if(configs[i].base)
    configs[i].link=configs[i].base+'#'+encodeURIComponent(r);
  document.getElementById('link-'+i).innerText=configs[i].link;
  document.getElementById('qr-'+i).innerHTML='';
}
function copyLink(i){navigator.clipboard.writeText(configs[i].link)}
function makeQR(i){
  const box=document.getElementById('qr-'+i);
  box.innerHTML='';
  new QRCode(box,{text:configs[i].link,width:150,height:150});
}

// ---------- Export ----------
function exportTXT(){
  download(configs.map(c=>c.link).join('\n'),'configs.txt');
}
function exportBase64(){
  download(btoa(configs.map(c=>c.link).join('\n')),'subscription.txt');
}
function download(text,name){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([text]));
  a.download=name;
  a.click();
}
</script>

</body>
</html>
